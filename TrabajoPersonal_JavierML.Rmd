---
title: "Trabajo_Personal_JavierML"
author: "Javier Martínez Lanciego"
date: "24/1/2022"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

# TRABAJO PERSONAL
Para la realización del trabajo, se hace uso de la dataset "nycflights13". Para ello, primero se lleva a cabo la instalación del paquete.

```{r}
install.packages("nycflights13")
```

## 1. Encuentra todos los vuelos que llegaron más de una hora tarde de lo previsto.

```{r}
fly<- nycflights13::flights


tarde <- fly[which(fly$arr_delay>60),]

dim(tarde)
print("Hay 27789 vuelos que llegaron mas de una hora tarde")
```

## 2.  Encuentra todos los vuelos que volaron hacia San Francisco (aeropuertos SFO y OAK) 

```{r}
ejer2<- fly[fly$dest == "SFO" | fly$dest == "OAK", ]
dim(ejer2)
print("13643 vuelos volaron hacia San Francisco")
```


## 3. Encuentra todos los vuelos operados por United American (UA) o por American Airlines (AA)

```{r}
ejer3<- fly[fly$carrier == "UA" | fly$carrier == "AA", ]
dim(ejer3)
print("91394 fueron operados por United American o American Airlines")
```

## 4.  Encuentra todos los vuelos que salieron los meses de primavera (Abril, Mayo y Junio)

```{r}
ejer4 <- fly[fly$month == 4 | fly$month == 5 | fly$month == 6, ]
dim(ejer4)
print("85369 vuelos salieron en primavera")
```


##  5. Encuentra todos los vuelos que llegaron más de una hora tarde pero salieron con menos de una hora de retraso. 

```{r}
ejer5 <- fly[which(fly$arr_delay>60 & fly$dep_delay<60), ]
dim(ejer5)
print("4956 vuelos llegaron mas de una hora tarde habiendo salido con menos de una hora de retraso")
```

##  6. Encuentra todos los vuelos que salieron con más de una hora de retraso pero consiguieron llegar con menos de 30 minutos de retraso (el avión aceleró en el aire) 

```{r}
ejer6 <- fly[which(fly$dep_delay>60 & fly$arr_delay<30), ]
dim(ejer6)
print("En 181 ocasiones el avion salio mas de una hora tarde pero consiguio llegar con menos de 30 minutos de retraso")

```


## 7. Encuentra todos los vuelos que salen entre medianoche y las 7 de la mañana (vuelos nocturnos). 

```{r}
ejer7 <- fly[which(fly$hour>=0 & fly$hour<=7), ]
dim(ejer7)
print("50726 vuelos se produjeron entre las medianoche y las 7 de la mañana")
```

## 8. ¿Cuántos vuelos tienen un valor desconocido de dep_time? 

```{r}
ejer8 <- fly[is.na(fly$dep_time), ]
dim(ejer8)
print("8255 vuelos tienen un valor desconocido de dep_time")
```

## 9. ¿Qué variables del dataset contienen valores desconocidos?

```{r}
apply(X = is.na(fly), MARGIN = 2, FUN = sum)
```


## 10. Ordena los vuelos de flights para encontrar los vuelos más retrasados en la salida. ¿Qué vuelos fueron los que salieron los primeros antes de lo previsto?

Los vuelos mas retrasados en la salida fueron:

```{r}
ejer10.1 <- fly[order(fly$dep_delay, na.last=FALSE), ]
tail(ejer10.1)
```

Los vuelos que salieron los primeros antes de lo previsto fueron:

```{r}
ejer10.2 <- fly[order(fly$dep_delay), ]
head(ejer10.2)
```


## 11.  Ordena los vuelos de flights para encontrar los vuelos más rápidos. Usa el concepto de rapidez que consideres.

Los vuelos mas rapidos fueron:

```{r}
fly$vel_med <- (fly$distance/fly$air_time)
ejer11 <- fly[order(fly$vel_med, decreasing=TRUE), ]
head(ejer11)
```


## 12.  ¿Qué vuelos tienen los trayectos más largos?

```{r}
ejer12 <- fly[order(fly$distance, decreasing=TRUE), ]
head(ejer12)
```


## 13. ¿Qué vuelos tienen los trayectos más cortos? 

```{r}
ejer13 <- fly[order(fly$distance), ]
head(ejer13)
```


## 14. El dataset de vuelos tiene dos variables, dep_time y sched_dep_time muy útiles pero difíciles de usar por cómo vienen dadas al no ser variables continuas. Fíjate que cuando pone 559, se refiere a que el vuelo salió a las 5:59... Convierte este dato en otro más útil que represente el número de minutos que pasan desde media noche. 

```{r}
fly$dep_time_min <- (fly$dep_time %/% 100 * 60 + fly$dep_time %% 100)

fly$sched_dep_time_min <- (fly$sched_dep_time %/% 100 * 60 + fly$sched_dep_time %% 100)
```

Con esos dos comandos se crean dos nuevas columnas en la dataset de vuelos que reflejan la hora de salida real y la hora de salida que debería de tener representadas por el numero de minutos que pasan desde medianoche.

## 15. Compara los valores de dep_time, sched_dep_time y dep_delay. ¿Cómo deberían relacionarse estos tres números? Compruébalo y haz las correcciones numéricas que  necesitas. 

Al compararlas, debería ocurrir que la resta del horario real de salida menos el horario que estaba programado, deberia de dar igual al delay en la salida. Esto no ocurre porque está puesto en formato HMM o HHMM. Por ello si efectuamos esta resta con las nuevas columnas creadas en el ejercicio 14, si que nos dan el dep_delay, ya que si que están pasadas al formato en minutos. Para comprobar que esto es cierto, creo una nueva columna llamada resta en la que efectuo la operacion |dep_time_min - sched_dep_time_min| - |dep_delay| . Toda esta columna deberia de dar 0 para todos los registros.

```{r}
fly$resta <- (abs(fly$dep_time_min - fly$sched_dep_time_min) - abs(fly$dep_delay))
table(fly$resta)
```

Como vemos, la mayoria de resultados son 0, por lo que son correctos, pero hay muchos valores que deben estar mal introducidos porque la resta no da 0. Por ello vamos a cambiarlos.

```{r}
fly$dep_delay <- (abs(fly$dep_time_min - fly$sched_dep_time_min))
fly$resta <- (abs(fly$dep_time_min - fly$sched_dep_time_min) - abs(fly$dep_delay))
table(fly$resta)
```













